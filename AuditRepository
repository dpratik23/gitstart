import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;
import java.sql.ResultSet;
import java.sql.SQLException;

@Repository
public class AuditRepository {

    private final JdbcTemplate jdbcTemplate;

    public AuditRepository(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
    }

    public AuditRecord findMessagesByServiceName(String serviceName) {
        String sql = "SELECT input_message, output_message FROM audit_table WHERE service_name = ?";
        return jdbcTemplate.queryForObject(sql, new Object[]{serviceName}, this::mapRowToAuditRecord);
    }

    private AuditRecord mapRowToAuditRecord(ResultSet rs, int rowNum) throws SQLException {
        AuditRecord record = new AuditRecord();
        record.setServiceName(rs.getString("service_name"));
        record.setInputMessage(rs.getString("input_message"));
        record.setOutputMessage(rs.getString("output_message"));
        return record;
    }
}
